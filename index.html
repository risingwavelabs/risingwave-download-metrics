<div>
  <canvas id="Cumulative Daily Downloads"></canvas>
</div>
<div>
  <canvas id="Daily Downloads"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  // Generate 1 year of data, 1 download per day
  async function test_data() {
    let data = []
    for (let month = 1; month <= 12; month++) {
      for (let day = 1; day <= 29; day++) {
        data.push({ date: `2023-${month}-${day}`, count: 1 });
      }
    }
    return data
  }
  async function fetch_data() {
    const response = await fetch('https://raw.githubusercontent.com/risingwavelabs/risingwave-download-metrics/main/mock_data.json');
    return await response.json();
  }
  async function fetch_mock_data() {
    const response = await fetch('https://raw.githubusercontent.com/risingwavelabs/risingwave-download-metrics/main/mock_data.json');
    return await response.json();
  }
  function aggregate_data(data) {
    return data.reduce((acc, {date, count}) => {
      const agg_count = acc[acc.length - 1].count + count;
      return [...acc, { date, count: agg_count }];
    }, [data[0]]);
  }

  async function main() {

    // Uncomment this to use test data.
    const daily_data = await fetch_mock_data();
    const aggregated_data = aggregate_data(daily_data);

    new Chart(document.getElementById('Cumulative Daily Downloads'), {
      type: 'line',
      data: {
        datasets: [{
          label: 'Cumulative Daily Downloads',
          data: aggregated_data,
          borderWidth: 1
        }]
      },
      options: {
        parsing: {
          xAxisKey: 'date',
          yAxisKey: 'count'
        },
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });

    new Chart(document.getElementById('Daily Downloads'), {
      type: 'line',
      data: {
        datasets: [{
          label: 'Daily Downloads',
          data: daily_data,
          borderWidth: 1
        }]
      },
      options: {
        parsing: {
          xAxisKey: 'date',
          yAxisKey: 'count'
        },
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });
  }
  main()
</script>

